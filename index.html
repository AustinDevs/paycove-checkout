<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .cart {
      width: 50%;
      margin: 0 auto;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 5px;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .cart-item:last-child {
      margin-bottom: 0;
    }
    .checkout {
      text-align: center;
      margin-top: 20px;
    }
    .checkout button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="cart">
    <h2>Shopping Cart</h2>
    <div class="user-info">
      <label for="full-name">Full Name:</label>
      <input type="text" id="full-name" name="full-name" required>
      <br>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
    </div>
    <div class="cart-item">
      <span>Item 1</span>
      <span>$10.00</span>
    </div>
    <div class="cart-item">
      <span>Item 2</span>
      <span>$15.00</span>
    </div>
    <div class="cart-item">
      <span>Item 3</span>
      <span>$20.00</span>
    </div>
    <div class="checkout">
      <button>Checkout</button>
    </div>
  </div>
  <br><br>
  <div><pre><code></code></pre></div>
</body>
<script>
  const buildUrl = () => {
    const name = document.getElementById('full-name').value;
    const email = document.getElementById('email').value;
    const items = document.querySelectorAll('.cart-item');
    const body = {
      line_items: [],
      contact: {
        name,
        email
      },
      type: 'invoice',
      success_url: `${window.location.origin}/paycove-checkout/thanks.html`,
      cancel_url: `${window.location.origin}/paycove-checkout/`,
      failure_url: `${window.location.origin}/paycove-checkout/`
    };
    let url = 'https://local.paycove.io/api/checkout/e3e742f36fb750a0151631184000807d';

    items.forEach((item, index) => {
      const itemName = item.children[0].textContent;
      const itemPrice = item.children[1].textContent.replace('$', '');
      body.line_items.push({
        name: itemName,
        price: itemPrice,
        quantity: 1
      });
    });

    return { url, body };
  }
  [...document.querySelectorAll('input')].forEach(el => el.addEventListener('keyup', () => document.querySelector('code').innerText = `
POST ${buildUrl().url}
${JSON.stringify(buildUrl().body, null, 2)}
`));
  document.querySelector('.checkout button').addEventListener('click', async () => {
    const { url, body } = buildUrl();
    const { checkout_url } = await (await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body)
    })).json();
    window.location.href = checkout_url;
  });
</script>
</html>
